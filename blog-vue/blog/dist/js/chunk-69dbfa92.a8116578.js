(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69dbfa92"],{2535:function(t,e,a){t.exports=a.p+"img/edit.5608f060.png"},"5f26":function(t,e,a){},"9fa3":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"banner",style:t.cover},[a("h1",{staticClass:"banner-title"},[t._v(t._s(this.$route.meta.title))])]),a("v-card",{staticClass:"blog-container"},[a("div",{staticClass:"title"},[t._v(t._s(this.$route.meta.title))]),a("div",{staticClass:"article-title-container"},[a("el-input",{attrs:{size:"medium",placeholder:"输入文章标题"},model:{value:t.article.articleTitle,callback:function(e){t.$set(t.article,"articleTitle",e)},expression:"article.articleTitle"}}),null==t.article.id||3==t.article.status?a("el-button",{staticClass:"save-btn",attrs:{type:"danger",size:"medium"},on:{click:t.saveArticleDraft}},[t._v(" 保存草稿 ")]):t._e(),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",size:"medium"},on:{click:t.openModel}},[t._v(" 发布文章 ")])],1),a("mavon-editor",{ref:"md",staticStyle:{height:"calc(100vh - 260px)"},on:{imgAdd:t.uploadImg},model:{value:t.article.articleContent,callback:function(e){t.$set(t.article,"articleContent",e)},expression:"article.articleContent"}}),a("el-dialog",{attrs:{visible:t.addOrEdit,width:"40%",top:"3vh"},on:{"update:visible":function(e){t.addOrEdit=e}}},[a("div",{staticClass:"dialog-title-container",attrs:{slot:"title"},slot:"title"},[t._v("发布文章")]),a("el-form",{attrs:{"label-width":"80px",size:"medium",model:t.article}},[a("el-form-item",{attrs:{label:"文章分类"}},[a("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.article.categoryName,expression:"article.categoryName"}],staticStyle:{margin:"0 1rem 0 0"},attrs:{type:"success",closable:!0},on:{close:t.removeCategory}},[t._v(" "+t._s(t.article.categoryName)+" ")]),t.article.categoryName?t._e():a("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"}},[a("div",{staticClass:"popover-title"},[t._v("分类")]),a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.searchCategories,placeholder:"请输入分类名搜索，enter可添加自定义分类","trigger-on-focus":!1},on:{select:t.handleSelectCategories},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveCategory(e)}},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("div",[t._v(t._s(i.categoryName))])]}}],null,!1,902057188),model:{value:t.categoryName,callback:function(e){t.categoryName=e},expression:"categoryName"}}),a("div",{staticClass:"popover-container"},t._l(t.categoryList,(function(e){return a("div",{key:e.id,staticClass:"category-item",on:{click:function(a){return t.addCategory(e)}}},[t._v(" "+t._s(e.categoryName)+" ")])})),0),a("el-button",{attrs:{slot:"reference",type:"success",plain:"",size:"small"},slot:"reference"},[t._v(" 添加分类 ")])],1)],1),a("el-form-item",{attrs:{label:"文章标签"}},[t._l(t.article.tagNameList,(function(e,i){return a("el-tag",{key:i,staticStyle:{margin:"0 1rem 0 0"},attrs:{closable:!0},on:{close:function(a){return t.removeTag(e)}}},[t._v(" "+t._s(e)+" ")])})),t.article.tagNameList.length<3?a("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"}},[a("div",{staticClass:"popover-title"},[t._v("标签")]),a("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.searchTags,placeholder:"请输入标签名搜索，enter可添加自定义标签","trigger-on-focus":!1},on:{select:t.handleSelectTag},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveTag(e)}},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("div",[t._v(t._s(i.tagName))])]}}],null,!1,3390268870),model:{value:t.tagName,callback:function(e){t.tagName=e},expression:"tagName"}}),a("div",{staticClass:"popover-container"},[a("div",{staticStyle:{"margin-bottom":"1rem"}},[t._v("添加标签")]),t._l(t.tagList,(function(e,i){return a("el-tag",{key:i,class:t.tagClass(e),on:{click:function(a){return t.addTag(e)}}},[t._v(" "+t._s(e.tagName)+" ")])}))],2),a("el-button",{attrs:{slot:"reference",type:"primary",plain:"",size:"small"},slot:"reference"},[t._v(" 添加标签 ")])],1):t._e()],2),a("el-form-item",{attrs:{label:"文章类型"}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:t.article.type,callback:function(e){t.$set(t.article,"type",e)},expression:"article.type"}},t._l(t.typeList,(function(t){return a("el-option",{key:t.type,attrs:{label:t.desc,value:t.type}})})),1)],1),1!=t.article.type?a("el-form-item",{attrs:{label:"原文地址"}},[a("el-input",{attrs:{placeholder:"请填写原文链接"},model:{value:t.article.originalUrl,callback:function(e){t.$set(t.article,"originalUrl",e)},expression:"article.originalUrl"}})],1):t._e(),a("el-form-item",{attrs:{label:"上传封面"}},[a("el-upload",{staticClass:"upload-cover",attrs:{drag:"",action:"/api/articles/images",multiple:"","before-upload":t.beforeUpload,"on-success":t.uploadCover}},[""==t.article.articleCover?a("i",{staticClass:"el-icon-upload"}):t._e(),""==t.article.articleCover?a("div",{staticClass:"el-upload__text"},[t._v(" 将文件拖到此处，或"),a("em",[t._v("点击上传")])]):a("img",{attrs:{src:t.article.articleCover,width:"360px",height:"180px"}})])],1),a("el-form-item",{attrs:{label:"置顶"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#F4F4F5","active-value":1,"inactive-value":0},model:{value:t.article.isTop,callback:function(e){t.$set(t.article,"isTop",e)},expression:"article.isTop"}})],1),a("el-form-item",{attrs:{label:"发布形式"}},[a("el-radio-group",{model:{value:t.article.status,callback:function(e){t.$set(t.article,"status",e)},expression:"article.status"}},[a("el-radio",{attrs:{label:1}},[t._v("公开")]),a("el-radio",{attrs:{label:2}},[t._v("私密")])],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.addOrEdit=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"danger"},on:{click:t.saveOrUpdateArticle}},[t._v(" 发 表 ")])],1)],1)],1)],1)},r=[],n=(a("c975"),a("a434"),a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),a("498a"),a("ba9f")),o={created:function(){var t=this,e=this.$route.path,a=e.split("/"),i=a[2];if(i)this.axios.get("/api/edit/"+i).then((function(e){var a=e.data;t.article=a.data}));else{var r=sessionStorage.getItem("article");r&&(this.article=JSON.parse(r))}},destroyed:function(){this.autoSaveArticle()},data:function(){return{addOrEdit:!1,autoSave:!0,categoryName:"",tagName:"",categoryList:[],tagList:[],typeList:[{type:1,desc:"原创"},{type:2,desc:"转载"},{type:3,desc:"翻译"}],article:{id:null,articleTitle:this.$moment(new Date).format("YYYY-MM-DD"),articleContent:"",articleCover:"",categoryName:null,tagNameList:[],originalUrl:"",isTop:0,type:1,status:1},cover:{backgroundImage:"url("+a("2535")+")",backgroundRepeat:"no-repeat",backgroundPosition:"center center",opacity:1,backgroundSize:"100% 100%"}}},methods:{listCategories:function(){var t=this;this.axios.get("/api/categories/search").then((function(e){var a=e.data;t.categoryList=a.data}))},listTags:function(){var t=this;this.axios.get("/api/tags/search").then((function(e){var a=e.data;t.tagList=a.data}))},openModel:function(){return""==this.article.articleTitle.trim()?(this.$message.error("文章标题不能为空"),!1):""==this.article.articleContent.trim()?(this.$message.error("文章内容不能为空"),!1):(this.listCategories(),this.listTags(),void(this.addOrEdit=!0))},uploadCover:function(t){this.article.articleCover=t.data},beforeUpload:function(t){var e=this;return new Promise((function(a){t.size/1024<e.config.UPLOAD_SIZE&&a(t),n["compressAccurately"](t,e.config.UPLOAD_SIZE).then((function(t){a(t)}))}))},uploadImg:function(t,e){var a=this,i=new FormData;e.size/1024<this.config.UPLOAD_SIZE?(i.append("file",e),this.axios.post("/api/articles/images",i).then((function(e){var i=e.data;a.$refs.md.$img2Url(t,i.data)}))):n["compressAccurately"](e,this.config.UPLOAD_SIZE).then((function(r){i.append("file",new window.File([r],e.name,{type:e.type})),a.axios.post("/api/articles/images",i).then((function(e){var i=e.data;a.$refs.md.$img2Url(t,i.data)}))}))},saveArticleDraft:function(){var t=this;return""==this.article.articleTitle.trim()?(this.$message.error("文章标题不能为空"),!1):""==this.article.articleContent.trim()?(this.$message.error("文章内容不能为空"),!1):(this.article.status=3,this.axios.post("/api/articles",this.article).then((function(e){var a=e.data;a.flag?(null===t.article.id?t.$store.commit("removeTab","发布文章"):t.$store.commit("removeTab","修改文章"),sessionStorage.removeItem("article"),t.$router.push({path:"/"}),t.$notify.success({title:"成功",message:"保存草稿成功"})):t.$notify.error({title:"失败",message:"保存草稿失败"})})),void(this.autoSave=!1))},saveOrUpdateArticle:function(){var t=this;return""==this.article.articleTitle.trim()?(this.$message.error("文章标题不能为空"),!1):""==this.article.articleContent.trim()?(this.$message.error("文章内容不能为空"),!1):null==this.article.categoryName?(this.$message.error("文章分类不能为空"),!1):0==this.article.tagNameList.length?(this.$message.error("文章标签不能为空"),!1):(this.axios.post("/api/articles",this.article).then((function(e){var a=e.data;a.flag?(null===t.article.id?t.$store.commit("removeTab","发布文章"):t.$store.commit("removeTab","修改文章"),sessionStorage.removeItem("article"),t.$router.push({path:"/"}),t.$notify.success({title:"成功",message:a.message})):t.$notify.error({title:"失败",message:a.message}),t.addOrEdit=!1})),void(this.autoSave=!1))},autoSaveArticle:function(){var t=this;this.autoSave&&""!=this.article.articleTitle.trim()&&""!=this.article.articleContent.trim()&&null!=this.article.id&&this.axios.post("/api/articles",this.article).then((function(e){var a=e.data;a.flag?t.$notify.success({title:"成功",message:"自动保存成功"}):t.$notify.error({title:"失败",message:"自动保存失败"})})),this.autoSave&&null==this.article.id&&sessionStorage.setItem("article",JSON.stringify(this.article))},searchCategories:function(t,e){this.axios.get("/api/categories/search",{params:{keywords:t}}).then((function(t){var a=t.data;e(a.data)}))},handleSelectCategories:function(t){this.addCategory({categoryName:t.categoryName})},saveCategory:function(){""!=this.categoryName.trim()&&(this.addCategory({categoryName:this.categoryName}),this.categoryName="")},addCategory:function(t){this.article.categoryName=t.categoryName},removeCategory:function(){this.article.categoryName=null},searchTags:function(t,e){this.axios.get("/api/tags/search",{params:{keywords:t}}).then((function(t){var a=t.data;e(a.data)}))},handleSelectTag:function(t){this.addTag({tagName:t.tagName})},saveTag:function(){""!=this.tagName.trim()&&(this.addTag({tagName:this.tagName}),this.tagName="")},addTag:function(t){-1==this.article.tagNameList.indexOf(t.tagName)&&this.article.tagNameList.push(t.tagName)},removeTag:function(t){var e=this.article.tagNameList.indexOf(t);this.article.tagNameList.splice(e,1)}},computed:{tagClass:function(){return function(t){var e=this.article.tagNameList.indexOf(t.tagName);return-1!=e?"tag-item-select":"tag-item"}}}},s=o,c=(a("f75e"),a("2877")),l=a("6544"),u=a.n(l),d=a("b0af"),h=Object(c["a"])(s,i,r,!1,null,"ac8c4d4c",null);e["default"]=h.exports;u()(h,{VCard:d["a"]})},ba9f:function(t,e,a){t.exports=a("c229")},c229:function(t,e,a){!function(e,a){t.exports=a()}(0,(function(){return function(t){var e={};function a(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(i,r,function(e){return t[e]}.bind(null,r));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";var i;function r(t){return["image/png","image/jpeg","image/gif"].some(e=>e===t)}a.r(e),a.d(e,"canvastoDataURL",(function(){return o})),a.d(e,"canvastoFile",(function(){return s})),a.d(e,"dataURLtoFile",(function(){return l})),a.d(e,"dataURLtoImage",(function(){return u})),a.d(e,"downloadFile",(function(){return d})),a.d(e,"filetoDataURL",(function(){return h})),a.d(e,"imagetoCanvas",(function(){return m})),a.d(e,"urltoBlob",(function(){return f})),a.d(e,"urltoImage",(function(){return p})),a.d(e,"compress",(function(){return y})),a.d(e,"compressAccurately",(function(){return b})),a.d(e,"EImageType",(function(){return i})),function(t){t.PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif"}(i||(i={}));var n=function(t,e,a,i){return new(a||(a=Promise))((function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}c((i=i.apply(t,e||[])).next())}))};function o(t,e=.92,a=i.JPEG){return n(this,void 0,void 0,(function*(){return r(a)||(a=i.JPEG),t.toDataURL(a,e)}))}function s(t,e=.92,a=i.JPEG){return new Promise(i=>t.toBlob(t=>i(t),a,e))}var c=function(t,e,a,i){return new(a||(a=Promise))((function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}c((i=i.apply(t,e||[])).next())}))};function l(t,e){return c(this,void 0,void 0,(function*(){const a=t.split(",");let i=a[0].match(/:(.*?);/)[1];const n=atob(a[1]);let o=n.length;const s=new Uint8Array(o);for(;o--;)s[o]=n.charCodeAt(o);return r(e)&&(i=e),new Blob([s],{type:i})}))}function u(t){return new Promise((e,a)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>a(new Error("dataURLtoImage(): dataURL is illegal")),i.src=t})}function d(t,e){const a=document.createElement("a");a.href=window.URL.createObjectURL(t),a.download=e||Date.now().toString(36),document.body.appendChild(a);const i=document.createEvent("MouseEvents");i.initEvent("click",!1,!1),a.dispatchEvent(i),document.body.removeChild(a)}function h(t){return new Promise(e=>{const a=new FileReader;a.onloadend=t=>e(t.target.result),a.readAsDataURL(t)})}var g=function(t,e,a,i){return new(a||(a=Promise))((function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}c((i=i.apply(t,e||[])).next())}))};function m(t,e={}){return g(this,void 0,void 0,(function*(){const a=Object.assign({},e),i=document.createElement("canvas"),r=i.getContext("2d");let n,o;for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&(a[t]=Number(a[t]));if(a.scale){const e=a.scale>0&&a.scale<10?a.scale:1;o=t.width*e,n=t.height*e}else o=a.width||a.height*t.width/t.height||t.width,n=a.height||a.width*t.height/t.width||t.height;switch([5,6,7,8].some(t=>t===a.orientation)?(i.height=o,i.width=n):(i.height=n,i.width=o),a.orientation){case 3:r.rotate(180*Math.PI/180),r.drawImage(t,-i.width,-i.height,i.width,i.height);break;case 6:r.rotate(90*Math.PI/180),r.drawImage(t,0,-i.width,i.height,i.width);break;case 8:r.rotate(270*Math.PI/180),r.drawImage(t,-i.height,0,i.height,i.width);break;case 2:r.translate(i.width,0),r.scale(-1,1),r.drawImage(t,0,0,i.width,i.height);break;case 4:r.translate(i.width,0),r.scale(-1,1),r.rotate(180*Math.PI/180),r.drawImage(t,-i.width,-i.height,i.width,i.height);break;case 5:r.translate(i.width,0),r.scale(-1,1),r.rotate(90*Math.PI/180),r.drawImage(t,0,-i.width,i.height,i.width);break;case 7:r.translate(i.width,0),r.scale(-1,1),r.rotate(270*Math.PI/180),r.drawImage(t,-i.height,0,i.height,i.width);break;default:r.drawImage(t,0,0,i.width,i.height)}return i}))}function f(t){return fetch(t).then(t=>t.blob())}function p(t){return new Promise((e,a)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>a(new Error("urltoImage(): Image failed to load, please check the image URL")),i.src=t})}var v=function(t,e,a,i){return new(a||(a=Promise))((function(r,n){function o(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}c((i=i.apply(t,e||[])).next())}))};function y(t,e={}){return v(this,void 0,void 0,(function*(){if(!(t instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if("object"!=typeof e&&(e=Object.assign({quality:e})),e.quality=Number(e.quality),Number.isNaN(e.quality))return t;const a=yield h(t);let n=a.split(",")[0].match(/:(.*?);/)[1],s=i.JPEG;r(e.type)&&(s=e.type,n=e.type);const c=yield u(a),d=yield m(c,Object.assign({},e)),g=yield o(d,e.quality,s),f=yield l(g,n);return f.size>t.size?t:f}))}function b(t,e={}){return v(this,void 0,void 0,(function*(){if(!(t instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if("object"!=typeof e&&(e=Object.assign({size:e})),e.size=Number(e.size),Number.isNaN(e.size))return t;if(1024*e.size>t.size)return t;e.accuracy=Number(e.accuracy),(!e.accuracy||e.accuracy<.8||e.accuracy>.99)&&(e.accuracy=.95);const a=e.size*(2-e.accuracy)*1024,n=1024*e.size,s=e.size*e.accuracy*1024,c=yield h(t);let d=c.split(",")[0].match(/:(.*?);/)[1],g=i.JPEG;r(e.type)&&(g=e.type,d=e.type);const f=yield u(c),p=yield m(f,Object.assign({},e));let v,y=.5;const b=[null,null];for(let t=1;t<=7;t++){v=yield o(p,y,g);const e=.75*v.length;if(7===t){(a<e||s>e)&&(v=[v,...b].filter(t=>t).sort((t,e)=>Math.abs(.75*t.length-n)-Math.abs(.75*e.length-n))[0]);break}if(a<e)b[1]=v,y-=Math.pow(.5,t+1);else{if(!(s>e))break;b[0]=v,y+=Math.pow(.5,t+1)}}const w=yield l(v,d);return w.size>t.size?t:w}))}}])}))},f75e:function(t,e,a){"use strict";var i=a("5f26"),r=a.n(i);r.a}}]);
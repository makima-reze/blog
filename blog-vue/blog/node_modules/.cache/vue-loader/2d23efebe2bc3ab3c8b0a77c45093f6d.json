{"remainingRequest":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\src\\views\\edit\\Edit.vue?vue&type=style&index=0&id=d24b1a36&scoped=true&lang=css&","dependencies":[{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\src\\views\\edit\\Edit.vue","mtime":1671957464245},{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\2023寒假\\java\\demo\\demo3-blog-X1192176811\\blog-master\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5hcnRpY2xlLXRpdGxlLWNvbnRhaW5lciB7DQogIGRpc3BsYXk6IGZsZXg7DQogIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogIG1hcmdpbi1ib3R0b206IDEuMjVyZW07DQogIG1hcmdpbi10b3A6IDIuMjVyZW07DQp9DQouc2F2ZS1idG4gew0KICBtYXJnaW4tbGVmdDogMC43NXJlbTsNCiAgYmFja2dyb3VuZDogI2ZmZjsNCiAgY29sb3I6ICNmNTZjNmM7DQp9DQoudGFnLWl0ZW0gew0KICBtYXJnaW4tcmlnaHQ6IDFyZW07DQogIG1hcmdpbi1ib3R0b206IDFyZW07DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCi50YWctaXRlbS1zZWxlY3Qgew0KICBtYXJnaW4tcmlnaHQ6IDFyZW07DQogIG1hcmdpbi1ib3R0b206IDFyZW07DQogIGN1cnNvcjogbm90LWFsbG93ZWQ7DQogIGNvbG9yOiAjY2NjY2Q4ICFpbXBvcnRhbnQ7DQp9DQouY2F0ZWdvcnktaXRlbSB7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgcGFkZGluZzogMC42cmVtIDAuNXJlbTsNCn0NCi5jYXRlZ29yeS1pdGVtOmhvdmVyIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2YwZjllYjsNCiAgY29sb3I6ICM2N2MyM2E7DQp9DQoucG9wb3Zlci10aXRsZSB7DQogIG1hcmdpbi1ib3R0b206IDFyZW07DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCi5wb3BvdmVyLWNvbnRhaW5lciB7DQogIG1hcmdpbi10b3A6IDFyZW07DQogIGhlaWdodDogMjYwcHg7DQogIG92ZXJmbG93LXk6IGF1dG87DQp9DQo="},{"version":3,"sources":["Edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Edit.vue","sourceRoot":"src/views/edit","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"banner\" :style=\"cover\">\r\n      <h1 class=\"banner-title\">新增文章</h1>\r\n    </div>\r\n    <v-card class=\"blog-container\">\r\n      <div class=\"title\">{{ this.$route.name }}</div>\r\n      <div class=\"article-title-container\">\r\n        <el-input\r\n          v-model=\"article.articleTitle\"\r\n          size=\"medium\"\r\n          placeholder=\"输入文章标题\"\r\n        />\r\n        <el-button\r\n          type=\"danger\"\r\n          size=\"medium\"\r\n          class=\"save-btn\"\r\n          @click=\"saveArticleDraft\"\r\n          v-if=\"article.id == null || article.status == 3\"\r\n        >\r\n          保存草稿\r\n        </el-button>\r\n        <el-button\r\n          type=\"danger\"\r\n          size=\"medium\"\r\n          @click=\"openModel\"\r\n          style=\"margin-left: 10px\"\r\n        >\r\n          发布文章\r\n        </el-button>\r\n      </div>\r\n    </v-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as imageConversion from \"image-conversion\";\r\nexport default {\r\n  created() {\r\n    const path = this.$route.path;\r\n    const arr = path.split(\"/\");\r\n    const articleId = arr[2];\r\n    if (articleId) {\r\n      this.axios.get(\"/api/articles/\" + articleId).then(({ data }) => {\r\n        this.article = data.data;\r\n      });\r\n    } else {\r\n      const article = sessionStorage.getItem(\"article\");\r\n      if (article) {\r\n        this.article = JSON.parse(article);\r\n      }\r\n    }\r\n  },\r\n  destroyed() {\r\n    //文章自动保存功能\r\n    this.autoSaveArticle();\r\n  },\r\n  data: function () {\r\n    return {\r\n      addOrEdit: false,\r\n      autoSave: true,\r\n      categoryName: \"\",\r\n      tagName: \"\",\r\n      categoryList: [],\r\n      tagList: [],\r\n      typeList: [\r\n        {\r\n          type: 1,\r\n          desc: \"原创\",\r\n        },\r\n        {\r\n          type: 2,\r\n          desc: \"转载\",\r\n        },\r\n        {\r\n          type: 3,\r\n          desc: \"翻译\",\r\n        },\r\n      ],\r\n      article: {\r\n        id: null,\r\n        articleTitle: this.$moment(new Date()).format(\"YYYY-MM-DD\"),\r\n        articleContent: \"\",\r\n        articleCover: \"\",\r\n        categoryName: null,\r\n        tagNameList: [],\r\n        originalUrl: \"\",\r\n        isTop: 0,\r\n        type: 1,\r\n        status: 1,\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n    listCategories() {\r\n      this.axios.get(\"/api/categories/search\").then(({ data }) => {\r\n        this.categoryList = data.data;\r\n      });\r\n    },\r\n    listTags() {\r\n      this.axios.get(\"/api/tags/search\").then(({ data }) => {\r\n        this.tagList = data.data;\r\n      });\r\n    },\r\n    openModel() {\r\n      if (this.article.articleTitle.trim() == \"\") {\r\n        this.$message.error(\"文章标题不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.articleContent.trim() == \"\") {\r\n        this.$message.error(\"文章内容不能为空\");\r\n        return false;\r\n      }\r\n      this.listCategories();\r\n      this.listTags();\r\n      this.addOrEdit = true;\r\n    },\r\n    uploadCover(response) {\r\n      this.article.articleCover = response.data;\r\n    },\r\n    beforeUpload(file) {\r\n      return new Promise((resolve) => {\r\n        if (file.size / 1024 < this.config.UPLOAD_SIZE) {\r\n          resolve(file);\r\n        }\r\n        // 压缩到200KB,这里的200就是要压缩的大小,可自定义\r\n        imageConversion\r\n          .compressAccurately(file, this.config.UPLOAD_SIZE)\r\n          .then((res) => {\r\n            resolve(res);\r\n          });\r\n      });\r\n    },\r\n    uploadImg(pos, file) {\r\n      var formdata = new FormData();\r\n      if (file.size / 1024 < this.config.UPLOAD_SIZE) {\r\n        formdata.append(\"file\", file);\r\n        this.axios.post(\"/api/articles/images\", formdata).then(({ data }) => {\r\n          this.$refs.md.$img2Url(pos, data.data);\r\n        });\r\n      } else {\r\n        // 压缩到200KB,这里的200就是要压缩的大小,可自定义\r\n        imageConversion\r\n          .compressAccurately(file, this.config.UPLOAD_SIZE)\r\n          .then((res) => {\r\n            formdata.append(\r\n              \"file\",\r\n              new window.File([res], file.name, { type: file.type })\r\n            );\r\n            this.axios\r\n              .post(\"/api/articles/images\", formdata)\r\n              .then(({ data }) => {\r\n                this.$refs.md.$img2Url(pos, data.data);\r\n              });\r\n          });\r\n      }\r\n    },\r\n    saveArticleDraft() {\r\n      if (this.article.articleTitle.trim() == \"\") {\r\n        this.$message.error(\"文章标题不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.articleContent.trim() == \"\") {\r\n        this.$message.error(\"文章内容不能为空\");\r\n        return false;\r\n      }\r\n      this.article.status = 3;\r\n      this.axios.post(\"/api/articles\", this.article).then(({ data }) => {\r\n        if (data.flag) {\r\n          if (this.article.id === null) {\r\n            this.$store.commit(\"removeTab\", \"发布文章\");\r\n          } else {\r\n            this.$store.commit(\"removeTab\", \"修改文章\");\r\n          }\r\n          sessionStorage.removeItem(\"article\");\r\n          this.$router.push({ path: \"/article-list\" });\r\n          this.$notify.success({\r\n            title: \"成功\",\r\n            message: \"保存草稿成功\",\r\n          });\r\n        } else {\r\n          this.$notify.error({\r\n            title: \"失败\",\r\n            message: \"保存草稿失败\",\r\n          });\r\n        }\r\n      });\r\n\r\n      //关闭自动保存功能\r\n      this.autoSave = false;\r\n    },\r\n    saveOrUpdateArticle() {\r\n      if (this.article.articleTitle.trim() == \"\") {\r\n        this.$message.error(\"文章标题不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.articleContent.trim() == \"\") {\r\n        this.$message.error(\"文章内容不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.categoryName == null) {\r\n        this.$message.error(\"文章分类不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.tagNameList.length == 0) {\r\n        this.$message.error(\"文章标签不能为空\");\r\n        return false;\r\n      }\r\n      if (this.article.articleCover.trim() == \"\") {\r\n        this.$message.error(\"文章封面不能为空\");\r\n        return false;\r\n      }\r\n      this.axios.post(\"/api/articles\", this.article).then(({ data }) => {\r\n        if (data.flag) {\r\n          if (this.article.id === null) {\r\n            this.$store.commit(\"removeTab\", \"发布文章\");\r\n          } else {\r\n            this.$store.commit(\"removeTab\", \"修改文章\");\r\n          }\r\n          sessionStorage.removeItem(\"article\");\r\n          this.$router.push({ path: \"/article-list\" });\r\n          this.$notify.success({\r\n            title: \"成功\",\r\n            message: data.message,\r\n          });\r\n        } else {\r\n          this.$notify.error({\r\n            title: \"失败\",\r\n            message: data.message,\r\n          });\r\n        }\r\n        this.addOrEdit = false;\r\n      });\r\n      //关闭自动保存功能\r\n      this.autoSave = false;\r\n    },\r\n    autoSaveArticle() {\r\n      // 自动上传文章\r\n      if (\r\n        this.autoSave &&\r\n        this.article.articleTitle.trim() != \"\" &&\r\n        this.article.articleContent.trim() != \"\" &&\r\n        this.article.id != null\r\n      ) {\r\n        this.axios.post(\"/api/articles\", this.article).then(({ data }) => {\r\n          if (data.flag) {\r\n            this.$notify.success({\r\n              title: \"成功\",\r\n              message: \"自动保存成功\",\r\n            });\r\n          } else {\r\n            this.$notify.error({\r\n              title: \"失败\",\r\n              message: \"自动保存失败\",\r\n            });\r\n          }\r\n        });\r\n      }\r\n      // 保存本地文章记录\r\n      if (this.autoSave && this.article.id == null) {\r\n        sessionStorage.setItem(\"article\", JSON.stringify(this.article));\r\n      }\r\n    },\r\n    searchCategories(keywords, cb) {\r\n      this.axios\r\n        .get(\"/api/categories/search\", {\r\n          params: {\r\n            keywords: keywords,\r\n          },\r\n        })\r\n        .then(({ data }) => {\r\n          cb(data.data);\r\n        });\r\n    },\r\n    handleSelectCategories(item) {\r\n      this.addCategory({\r\n        categoryName: item.categoryName,\r\n      });\r\n    },\r\n    saveCategory() {\r\n      if (this.categoryName.trim() != \"\") {\r\n        this.addCategory({\r\n          categoryName: this.categoryName,\r\n        });\r\n        this.categoryName = \"\";\r\n      }\r\n    },\r\n    addCategory(item) {\r\n      this.article.categoryName = item.categoryName;\r\n    },\r\n    removeCategory() {\r\n      this.article.categoryName = null;\r\n    },\r\n    searchTags(keywords, cb) {\r\n      this.axios\r\n        .get(\"/api/tags/search\", {\r\n          params: {\r\n            keywords: keywords,\r\n          },\r\n        })\r\n        .then(({ data }) => {\r\n          cb(data.data);\r\n        });\r\n    },\r\n    handleSelectTag(item) {\r\n      this.addTag({\r\n        tagName: item.tagName,\r\n      });\r\n    },\r\n    saveTag() {\r\n      if (this.tagName.trim() != \"\") {\r\n        this.addTag({\r\n          tagName: this.tagName,\r\n        });\r\n        this.tagName = \"\";\r\n      }\r\n    },\r\n    addTag(item) {\r\n      if (this.article.tagNameList.indexOf(item.tagName) == -1) {\r\n        this.article.tagNameList.push(item.tagName);\r\n      }\r\n    },\r\n    removeTag(item) {\r\n      const index = this.article.tagNameList.indexOf(item);\r\n      this.article.tagNameList.splice(index, 1);\r\n    },\r\n  },\r\n  computed: {\r\n    tagClass() {\r\n      return function (item) {\r\n        const index = this.article.tagNameList.indexOf(item.tagName);\r\n        return index != -1 ? \"tag-item-select\" : \"tag-item\";\r\n      };\r\n    },\r\n    cover() {\r\n      var cover = \"\";\r\n      this.$store.state.blogInfo.pageList.forEach((item) => {\r\n        if (item.pageLabel == \"link\") {\r\n          cover = item.pageCover;\r\n        }\r\n      });\r\n      return \"background: url(\" + cover + \") center center / cover no-repeat\";\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.article-title-container {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 1.25rem;\r\n  margin-top: 2.25rem;\r\n}\r\n.save-btn {\r\n  margin-left: 0.75rem;\r\n  background: #fff;\r\n  color: #f56c6c;\r\n}\r\n.tag-item {\r\n  margin-right: 1rem;\r\n  margin-bottom: 1rem;\r\n  cursor: pointer;\r\n}\r\n.tag-item-select {\r\n  margin-right: 1rem;\r\n  margin-bottom: 1rem;\r\n  cursor: not-allowed;\r\n  color: #ccccd8 !important;\r\n}\r\n.category-item {\r\n  cursor: pointer;\r\n  padding: 0.6rem 0.5rem;\r\n}\r\n.category-item:hover {\r\n  background-color: #f0f9eb;\r\n  color: #67c23a;\r\n}\r\n.popover-title {\r\n  margin-bottom: 1rem;\r\n  text-align: center;\r\n}\r\n.popover-container {\r\n  margin-top: 1rem;\r\n  height: 260px;\r\n  overflow-y: auto;\r\n}\r\n</style>\r\n"]}]}